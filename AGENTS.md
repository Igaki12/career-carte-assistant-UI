# Career Carte Assistant – エージェント設計メモ

## 1. プロジェクトのゴールと開発方針
- まずは **APIキー入力モーダル / チャットUI / カルテ更新ロジック / 音声入出力 / VRMステージ** の5要素が単体で安定動作する状態を作る。
- その後、これらのコンポーネントを **スマートフォン（特に幅の狭い端末）でも読みやすく・操作しやすいよう最適化** していく段階的アプローチを取る。
- 参考資料として調査済みの「次世代医療面接AIシステム」報告書を土台にし、日本型の事前問診モデルと海外アンビエントAIモデルの知見を融合したUI/UXを目指す。

## 2. 技術スタックとOpenAI APIの使い方
- クライアント：Vite + React + TypeScript、UIはChakra UI、3DはThree.js + @pixiv/three-vrm。
- 会話モデル：OpenAI公式の最新モデルガイド[^1]を参照し、ChatGPT 5.1（`gpt-5.1`）を既定値として `/v1/chat/completions` API から呼び出す。
- 音声合成：OpenAI Text-to-Speechガイド[^2]に沿い `tts-1` を利用。UI側では発話中にVRM表情を Surprised 0.0–0.3 でランダム変化させる。
- Whisper (STT) → GPT-5.1 → TTS-1 の一連処理は、将来的にRealtime APIへ置き換えられるよう関数分割しておく。

[^1]: https://platform.openai.com/docs/guides/latest-model?lang=javascript  
[^2]: https://platform.openai.com/docs/guides/text-to-speech

## 3. 問診AIのリサーチから得た重要示唆
1. **7つの主訴項目（キャリアカルテ版）**  
   - 医療カルテのメソッドを踏襲しつつ、以下の標準スロットを JSON 管理する。企業ごとに ON/OFF や文言差し替えが可能。  
     - **A. 主訴**（いま困っていること・話したいこと）  
     - **B. キャリア歴**（経験・強み・転機）  
     - **C. 現在の業務状況**（役割／満足点／不満点）  
     - **D. キャリア観・価値観**  
     - **E. 将来イメージ**（3〜5年後）  
     - **F. 学び・成長ニーズ**  
     - **G. 面談で話したいテーマ**（期待点）  
   - 各セクションは **3〜5往復を上限**とし、全体は **15〜20分**で自然にクロージングするようターン制御。  
   - Structured Outputs（response_format: json_schema）でスロットを厳密化し、カルテ用データを直接出力できるよう準備する。

2. **国内外のアーキテクチャ比較**  
   - 日本：Ubie や SymView が代表する「事前問診」文化。患者入力ベースでトリアージとカルテ補助を完結。  
   - 海外：Ambience Healthcare や Nabla、Corti など「アンビエント・スクライブ」型。医師と患者の会話をリアルタイムで書記化し、請求・CDI まで支援。  
   - 今回のプロジェクトは、日本型のスロット充填と海外型の自然対話スクライブを **LangGraph的オーケストレーション** で統合するハイブリッド像を目指す。

3. **将来展望**  
   - Realtime API + VAD で割り込み可能な音声対話を実装 → AIが不足情報を能動的に確認。  
   - 医療ガイドラインをRAGで参照し、ハルシネーションを抑制。  
   - 「AIレジデント」として予備問診〜鑑別疾患提示〜サマリ作成までを自動連携するロードマップを描く。

## 4. 現状のコンポーネント状況
| コンポーネント | 状態 | 留意点 |
| --- | --- | --- |
| ApiKeyModal / LocalStorage | ✅ | いつでも再入力できる動線を維持 |
| モード切替 (順次ヒアリング / 自由対話) | ✅ | 各モード専用プロンプトを定期的にチューニング |
| Whisper STT / マイク録音 | ✅ | Realtime API 移行まではブラウザ録音の互換性を確認 |
| GPT-5.1 チャット制御 | ✅ | `response_format: json_object` → 近いうち JSON Schema へ拡張 |
| カルテ UI (7スロット) | ✅ | 狭い画面では折りたたみ or 水平スクロール検討 |
| VRM ステージ | ✅ | 5秒バブル表示 + カメラ移動 + Blink/Nod/Surprised。低スペック端末でのFPS監視 |

## 5. 次のマイルストーン
1. **モバイル最適化**  
   - チャットと VRM の縦並び / カルテ折りたたみ / マイクボタン位置の再考。  
2. **Structured Output 対応**  
   - `response_format` を JSON Schema に置き換え、KarteData を型安全に更新。  
3. **Xserver VPS を前提としたフロント完成度向上**  
   - GitHub Pages 環境でフロント側のデータ構造・UIを固め、後段の Node.js + MySQL + REST API 連携を想定したダミー実装を整備。  
4. **バックエンド接続計画の具体化**  
   - VPS (Xserver) での Node.js / MySQL 導入を見据え、エンドポイント設計や認証フローを文書化。これにより、完成したフロントをそのまま本番環境へ接続しやすくする。

以上をロードマップとして、まずは全ユニットの安定動作を確保し、その後モバイル表示と高度対話制御を段階的に実装していく。***
